
# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞: Mocking, —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏ —Ç–∞ CI/CD (GitHub Actions)

## –ú–µ—Ç–∞
1. –ó–∞–∫—Ä—ñ–ø–∏—Ç–∏ **mocking** —É unit-—Ç–µ—Å—Ç–∞—Ö (—ñ–∑–æ–ª—å–æ–≤–∞–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–∫–∏).
2. –ù–∞–≤—á–∏—Ç–∏—Å—è –ø–∏—Å–∞—Ç–∏ **—ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏** (—Ä–µ–∞–ª—å–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ Postgres —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ).
3. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ **CI/CD —É GitHub Actions**, —â–æ–± PR –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–≤ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É, —è–∫—â–æ —Ç–µ—Å—Ç–∏/coverage –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –≤–∏–º–æ–≥–∞–º.

---

## –©–æ –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ
–í–∞–º –Ω–∞–¥–∞—î—Ç—å—Å—è [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –∑ –±–∞–∑–æ–≤–∏–º –∫–æ–¥–æ–º `OrderService`](https://github.com/this4you/qa-mocking-lab) —Ç–∞ **—Å—Ç–∞—Ä—Ç–æ–≤–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏**, —è–∫—ñ –Ω–∞–≤–º–∏—Å–Ω–æ –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å –ø—Ä–∏–±–ª–∏–∑–Ω–æ **~30%** –ª–æ–≥—ñ–∫–∏.

–í–∞—à–µ –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî **–¥–æ–ø–∏—Å–∞—Ç–∏ —Ç–µ—Å—Ç–∏** (—ñ –Ω–µ–≤–µ–ª–∏–∫—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –ø–æ—Ç—Ä–µ–±–∏), —â–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤–∏–º–æ–≥–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó.

---

## –í–∏–º–æ–≥–∏ –¥–æ –æ—Ç–æ—á–µ–Ω–Ω—è
- **Node.js**: 18+ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ LTS)
- **npm**: 9+ (–π–¥–µ —Ä–∞–∑–æ–º –∑ Node)
- **Git**: –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π
- –û–°: Windows / macOS / Linux

> –ü–æ—Ä–∞–¥–∞: —è–∫—â–æ —É –≤–∞—Å –¥–µ–∫—ñ–ª—å–∫–∞ –≤–µ—Ä—Å—ñ–π Node, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `nvm` (–æ–ø—Ü—ñ–π–Ω–æ).

---

## 1) –Ø–∫ –∫–ª–æ–Ω—É–≤–∞—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
1. –°–∫–æ–ø—ñ—é–π—Ç–µ URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é (–≤–∏–∫–ª–∞–¥–∞—á –Ω–∞–¥–∞—Å—Ç—å).
2. –í–∏–∫–æ–Ω–∞–π—Ç–µ –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ:

```bash
git clone <REPO_URL>
```

---

## 2) –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
–£ –∫–æ—Ä–µ–Ω—ñ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é –≤–∏–∫–æ–Ω–∞–π—Ç–µ:

```bash
npm install
```

---

## 3) –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤ –ª–æ–∫–∞–ª—å–Ω–æ
### –ó–∞–ø—É—Å–∫ —É—Å—ñ—Ö —Ç–µ—Å—Ç—ñ–≤
```bash
npm test
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤ –∑ coverage
```bash
npm run test:coverage
```

–ü—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É coverage —É –∫–æ–Ω—Å–æ–ª—ñ –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ –≤—ñ–¥—Å–æ—Ç–∫–∏ –ø–æ–∫—Ä–∏—Ç—Ç—è. –¢–∞–∫–æ–∂ –∑‚Äô—è–≤–∏—Ç—å—Å—è –ø–∞–ø–∫–∞ `coverage/` (–ª–æ–∫–∞–ª—å–Ω–æ).

---

## 4) –û–ø–∏—Å –∑–∞–¥–∞—á—ñ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó
–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó —î —Å–µ—Ä–≤—ñ—Å `OrderService`, —è–∫–∏–π:
- –≤–∞–ª—ñ–¥–æ–≤—É—î —ñ–Ω–ø—É—Ç,
- —Ä–∞—Ö—É—î subtotal/discount/shipping/tax,
- –∑–∞—Å—Ç–æ—Å–æ–≤—É—î risk-rules,
- –≤–∏–∫–ª–∏–∫–∞—î `paymentClient.charge(...)`,
- –ø—Ä–∏ —É—Å–ø—ñ—Ö—É –Ω–∞–¥—Å–∏–ª–∞—î email —á–µ—Ä–µ–∑ `emailClient.send(...)`,
- –ø—Ä–∏ –≤—ñ–¥–º–æ–≤—ñ –ø–ª–∞—Ç–µ–∂—É –∫–∏–¥–∞—î –ø–æ–º–∏–ª–∫—É —ñ **–Ω–µ** –Ω–∞–¥—Å–∏–ª–∞—î email.

–°—Ç–∞—Ä—Ç–æ–≤—ñ —Ç–µ—Å—Ç–∏ –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å –ª–∏—à–µ:
- happy-path (approved),
- validation: empty items.

---

## 5) –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–±–∏—Ç–∏ (–≤–∏–º–æ–≥–∏)
### A. Unit-—Ç–µ—Å—Ç–∏ –∑ mocking (–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)
–ù–∞–ø–∏—à—ñ—Ç—å unit-—Ç–µ—Å—Ç–∏ –¥–ª—è `OrderService`, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **–º–æ–∫–∏** –¥–ª—è:
- `PaymentClient`
- `EmailClient`

–£ —Ç–µ—Å—Ç–∞—Ö –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –Ω–µ —Ç—ñ–ª—å–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∞ –π **–≤–∏–∫–ª–∏–∫–∏ –º–æ–∫—ñ–≤**: –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∫–ª–∏–∫—ñ–≤, –ø–∞—Ä–∞–º–µ—Ç—Ä–∏, —â–æ email –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —É –Ω–µ–≥–∞—Ç–∏–≤–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö.

### B. –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏ (–ø–æ –±–∞–∂–∞–Ω–Ω—é)
–î–æ–¥–∞–π—Ç–µ **—ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏** –∑ —Ä–µ–∞–ª—å–Ω–æ—é –ë–î:
- –ø—ñ–¥–Ω—è—Ç–∏ **PostgreSQL —É Docker** (—á–µ—Ä–µ–∑ GitHub Actions services ‚Äî —É CI, —ñ —á–µ—Ä–µ–∑ docker compose –∞–±–æ –∫–æ–º–∞–Ω–¥–æ—é –ª–æ–∫–∞–ª—å–Ω–æ),
- —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø—Ä–æ—Å—Ç–∏–π `OrderRepository` (–∞–±–æ –º–æ–¥—É–ª—å –∑ –∑–∞–ø–∏—Å–æ–º/—á–∏—Ç–∞–Ω–Ω—è–º –∑–∞–º–æ–≤–ª–µ–Ω—å),
- —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ –¥–∞–Ω—ñ —Ä–µ–∞–ª—å–Ω–æ –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è/—á–∏—Ç–∞—é—Ç—å—Å—è.

> –î–æ–∑–≤–æ–ª–µ–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –±—É–¥—å-—è–∫—É —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—é –¥–æ—Å—Ç—É–ø—É –¥–æ –ë–î: `pg`, `knex`, `typeorm`, `prisma` ‚Äî –Ω–∞ –≤–∞—à –≤–∏–±—ñ—Ä (–∫—Ä–∞—â–µ `pg` –∞–±–æ `knex` –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏).

### C. GitHub Actions (–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)
–ù–∞–ª–∞—à—Ç—É–π—Ç–µ workflow, —è–∫–∏–π –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –Ω–∞:
- `pull_request`
- `push` —É `main`

Workflow –º–∞—î:
1. –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ (`npm ci`);
2. –∑–∞–ø—É—Å–∫–∞—Ç–∏ unit + integration —Ç–µ—Å—Ç–∏;
3. –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ coverage —ñ –≤–∞–ª–∏—Ç–∏ pipeline, —è–∫—â–æ –≤—ñ–Ω –Ω–∏–∂—á–∏–π –∑–∞ –ø–æ—Ä—ñ–≥.

---

## 6) –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –∫—Ä–∏—Ç–µ—Ä—ñ—ó –∑–¥–∞—á—ñ
‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –º—ñ—Å—Ç–∏—Ç—å:
- –Ω–æ–≤—ñ/–æ–Ω–æ–≤–ª–µ–Ω—ñ unit-—Ç–µ—Å—Ç–∏ –∑ mocking;
- `.github/workflows/ci.yml` (–∞–±–æ –∞–Ω–∞–ª–æ–≥) –∑ GitHub Actions;
- README –∞–±–æ —Ü–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –∑ –∫–æ—Ä–æ—Ç–∫–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ –∑–∞–ø—É—Å–∫—É.

‚úÖ –£ GitHub Actions –Ω–∞ PR:
- pipeline –ø—Ä–æ—Ö–æ–¥–∏—Ç—å,
- –≤–∏–¥–Ω–æ —Ç–µ—Å—Ç–æ–≤–∏–π –ø—Ä–æ–≥—ñ–Ω,
- coverage –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–∏–º–æ–≥–∞–º.

---

## 7) Coverage-–≤–∏–º–æ–≥–∏
- **Statements / Branches / Functions / Lines**: **80%+** (–º—ñ–Ω—ñ–º—É–º)
- –í–∞–∂–ª–∏–≤–æ: –ø–æ–∫—Ä–∏—Ç—Ç—è –º–∞—î –±—É—Ç–∏ –Ω–µ ‚Äú–Ω–∞–∫—Ä—É—á–µ–Ω–µ‚Äù, –∞ –∑–º—ñ—Å—Ç–æ–≤–Ω–µ: —Ç–µ—Å—Ç–∏ –Ω–∞ –∫–ª—é—á–æ–≤—ñ –≥—ñ–ª–∫–∏ –ª–æ–≥—ñ–∫–∏.

---

## 8) –°–ø–∏—Å–æ–∫ —Ç–æ–≥–æ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–∫—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–∞–º–∏ (checklist)
–ù–∏–∂—á–µ ‚Äî —Å–ø–∏—Å–æ–∫ **–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–∏—Ö** —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ (–º—ñ–Ω—ñ–º—É–º). –í–∏ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ –±—ñ–ª—å—à–µ.

### 8.1 Validation
- [ ] invalid email (–±–µ–∑ `@`) ‚Üí `VALIDATION: invalid email`
- [ ] empty items ‚Üí `VALIDATION: empty items` (–≤–∂–µ —î)
- [ ] invalid sku (–ø–æ—Ä–æ–∂–Ω—ñ–π) ‚Üí `VALIDATION: invalid sku`
- [ ] invalid qty (0 / –≤—ñ–¥‚Äô—î–º–Ω–∏–π / –Ω–µ integer) ‚Üí `VALIDATION: invalid qty`
- [ ] invalid price (<= 0 –∞–±–æ NaN/Infinity) ‚Üí `VALIDATION: invalid price`

### 8.2 Coupons / Discount
- [ ] `SAVE10` ‚Üí –∑–Ω–∏–∂–∫–∞ 10%
- [ ] `SAVE20` ‚Üí –∑–Ω–∏–∂–∫–∞ 20%
- [ ] `WELCOME...` ‚Üí 5% –∞–ª–µ –º–∞–∫—Å–∏–º—É–º $15 (1500 cents)
- [ ] unknown coupon ‚Üí `VALIDATION: unknown coupon`
- [ ] coupon trimming/case-insensitive (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `" save10 "`)

### 8.3 Shipping
- [ ] shipping –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –ø—Ä–∏ subtotal >= 5000 cents
- [ ] shipping –ø–ª–∞—Ç–Ω–∏–π –ø—Ä–∏ subtotal < 5000 cents
- [ ] USD vs EUR –±–∞–∑–æ–≤–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ (–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä—ñ–∑–Ω–∏—Ü—é)

### 8.4 Tax
- [ ] EUR VAT 20%
- [ ] USD tax 8.25%
- [ ] taxable <= 0 ‚Üí tax 0

### 8.5 Risk rules
- [ ] email `@tempmail.com` ‚Üí `RISK: tempmail is not allowed`
- [ ] total > 200000 cents ‚Üí `RISK: amount too high`
- [ ] email –º—ñ—Å—Ç–∏—Ç—å `+` —ñ total > 50000 ‚Üí `RISK: plus-alias high amount`

### 8.6 Payment + Email behavior
- [ ] payment declined ‚Üí error `PAYMENT_DECLINED: ...` —ñ **email –ù–ï –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è**
- [ ] approved ‚Üí email –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è 1 —Ä–∞–∑, –∑ –æ—á—ñ–∫—É–≤–∞–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- [ ] –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ `paymentClient.charge` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∑ –∫–æ—Ä–µ–∫—Ç–Ω–æ—é —Å—É–º–æ—é/–≤–∞–ª—é—Ç–æ—é

### 8.7 Edge cases (–º—ñ–Ω—ñ–º—É–º 1-2)
- [ ] –æ–∫—Ä—É–≥–ª–µ–Ω–Ω—è cents –¥–ª—è price –∑ –¥—Ä–æ–±–∞–º–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 10.005)
- [ ] –¥–µ–∫—ñ–ª—å–∫–∞ items ‚Üí –∫–æ—Ä–µ–∫—Ç–Ω–∏–π subtotal
- [ ] discount –Ω–µ —Ä–æ–±–∏—Ç—å total –≤—ñ–¥‚Äô—î–º–Ω–∏–º (Math.max(0, ...))

---

## 9) –Ø–∫ –∑–¥–∞–≤–∞—Ç–∏
1. –ó—Ä–æ–±—ñ—Ç—å **fork** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é —É —Å–≤—ñ–π GitHub.
2. –†–µ–∞–ª—ñ–∑—É–π—Ç–µ –∑–º—ñ–Ω–∏ –≤ –æ–∫—Ä–µ–º—ñ–π –≥—ñ–ª—Ü—ñ.
3. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Pull Request —É –≤–∞—à–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó (–∞–±–æ –≤ fork ‚Üí main).
4. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ GitHub Actions **–∑–µ–ª–µ–Ω–∏–π** ‚úÖ
5. –ù–∞–¥—ñ—à–ª—ñ—Ç—å:
    - –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π,
    - –ø–æ—Å–∏–ª–∞–Ω–Ω—è/—Å–∫—Ä—ñ–Ω –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è GitHub Actions (workflow run).

---

## 10) –ü–æ—Ä–∞–¥–∏
- –ü–∏—à—ñ—Ç—å —Ç–µ—Å—Ç–∏ ‚ÄúGiven / When / Then‚Äù (–∫–æ–º–µ–Ω—Ç–∞—Ä—è–º–∏ –∞–±–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é).
- –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `setTimeout` –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏ ‚Äî –∫—Ä–∞—â–µ –º–æ–∫–∞—Ç–∏ —á–∞—Å/—Ä–∞–Ω–¥–æ–º –ø—Ä–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ.
- –î–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Ç–µ—Å—Ç—ñ–≤ ‚Äî —Ä–æ–±—ñ—Ç—å **—ñ–∑–æ–ª—å–æ–≤–∞–Ω—ñ** –¥–∞–Ω—ñ (clean-up –ø—ñ—Å–ª—è —Ç–µ—Å—Ç—ñ–≤).
- –¢—Ä–∏–º–∞–π—Ç–µ —Ç–µ—Å—Ç–∏ —à–≤–∏–¥–∫–∏–º–∏: unit ‚Äî –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∏, integration ‚Äî —Å–µ–∫—É–Ω–¥–Ω—ñ.

–£—Å–ø—ñ—Ö—ñ–≤! üöÄ
